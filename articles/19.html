<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>0820 _ Aptos のアカウント生成</title><meta name="next-head-count" content="3"/><link rel="preload" href="/gialog/_next/static/css/4203b26684364480.css" as="style"/><link rel="stylesheet" href="/gialog/_next/static/css/4203b26684364480.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/gialog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/gialog/_next/static/chunks/webpack-b6d3dfeededadb8a.js" defer=""></script><script src="/gialog/_next/static/chunks/framework-1f10003e17636e37.js" defer=""></script><script src="/gialog/_next/static/chunks/main-081902de2ec959a7.js" defer=""></script><script src="/gialog/_next/static/chunks/pages/_app-ab8ac1d84e86eb4c.js" defer=""></script><script src="/gialog/_next/static/chunks/582-d79da0492f1f9267.js" defer=""></script><script src="/gialog/_next/static/chunks/pages/articles/%5BissueNumber%5D-1bcd5005fc9533d6.js" defer=""></script><script src="/gialog/_next/static/JPGmInjco_EPal4DLj749/_buildManifest.js" defer=""></script><script src="/gialog/_next/static/JPGmInjco_EPal4DLj749/_ssgManifest.js" defer=""></script><script src="/gialog/_next/static/JPGmInjco_EPal4DLj749/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-gray-50 dark:bg-gray-800 dark:text-gray-100"><header class="container mx-auto max-w-2xl px-8 py-12"><nav><p><a class="font-bold text-gray-900 visited:text-gray-900 dark:text-gray-300 dark:visited:text-gray-300" href="/gialog">ma96o&#x27;s dialy</a></p></nav></header><main class="container mx-auto max-w-2xl px-8 py-12 shadow-md bg-white dark:bg-gray-900"><div class="divide-y divide-gray-300 dark:divide-gray-700"><article class="markdown"><header><time dateTime="2022-08-20T13:14:11Z" title="2022-08-20T13:14:11Z" class="block text-[.8rem] text-gray-500 dark:text-gray-400">2022-08-20</time><h1>0820 _ Aptos のアカウント生成</h1></header><aside class="block text-[.8rem] text-gray-500 dark:text-gray-400"><p>Posted by <!-- --><a href="https://github.com/ma96o">ma96o</a> at <!-- --><a href="https://github.com/ma96o/gialog/issues/19">#19</a>.<!-- --></p></aside><div><p>Aptosにおける，アカウント作成時の暗号化手順</p>
<ol start="0">
<li>ユーザーがアカウント作成要求を送信</li>
<li>秘密鍵と公開鍵のキーペアの生成</li>
<li>ユーザーから，そのアカウントに適した署名方式を取得
<ul>
<li>単一署名方式 or マルチシグ方式</li>
</ul>
</li>
<li>公開鍵とユーザーの署名方式を組み合わせ，32バイトの認証鍵を生成する</li>
<li>認証鍵とシーケンス番号（初期値0）の両方が，初期アカウントリソースとしてアカウントに保存される</li>
<li>認証鍵から32バイトのアカウントアドレスを生成</li>
</ol>
<p>シーケンス番号は，そのアカウントから送信されたトランザクション数を示す．トランザクションにはシーケンス番号を含み，トランザクションを処理する際に，トランザクションに含まれるシーケンス番号とアカウントが保持するシーケンス番号を比較し，一致する場合のみ実行に移す．これはリプレイ攻撃を防ぐためのもので，Ethereum だと nonce にあたる．</p>
<p>アカウントアドレスは，アカウントの識別子として重要なリソースであるが，アカウント生成時に導出される32バイトの認証鍵がそのままアカウントアドレスになる（例：`eeff357ea5c1a4e7bc11b2b17ff2dc2dcca69750bfef1e1ebcaccf8c8018175b``）．
秘密鍵と公開鍵をのちに更新でき，その場合は認証鍵も変更される．しかし，アカウントアドレスは永続的（不変）であり，認証鍵とアカウントアドレスが一致するのは，初期のみで必ずしも一致しないし，既存のアカウントアドレスが変更されることはない．</p>
<p>Aptos の署名方式には2つある．</p>
<ol>
<li>単一署名方式</li>
<li>マルチシグ方式</li>
</ol>
<p>それぞれの署名方式は以下の署名スキームを用いる</p>
<ol>
<li><a href="https://github.com/ma96o/gialog/commit/Ed25519"><code>Ed25519</code></a></li>
<li>MultiEd25519</li>
</ol>
<p>また，アカウントの認証鍵を生成するには，そのアカウントについて1バイトの署名方式の識別子の指定が必要で，それぞれ以下のように識別子が定められている．</p>
<ol>
<li>単一署名方式： <code>0x00</code></li>
<li>マルチシグ方式：<code>0x01</code></li>
</ol>
<p>それぞれの署名方式によるアカウントの生成手順は以下である．</p>
<ul>
<li>
<p>単一署名方式</p>
<ol>
<li>キーペア（公開鍵，秘密鍵）の生成
<ul>
<li>RFC 8032 で定義された <a href="https://github.com/ma96o/gialog/commit/Ed25519"><code>Ed25519</code></a> curve 上の PureEdDSA スキームを使用</li>
</ul>
</li>
<li>公開鍵から，32バイトの認証鍵を導出
<ul>
<li><code>auth_key = sha3-256(publicke | 0x00)</code></li>
</ul>
</li>
<li>（永続的な）アカウントアドレスとして，2で導出した初期認証鍵を設定</li>
</ol>
</li>
<li>
<p>マルチシグ方式</p>
<ul>
<li>K-of-Nマルチシグ認証を用いるため，定数 N, K を指定する必要がある</li>
<li>K-of-Nマルチシグ認証では，アカウントに合計 N 人の署名者が存在し，N 人の署名のうち少なくとも K 人がトランザクションを認証するためにしようされなければならない</li>
</ul>
<ol>
<li>キーペア（公開鍵，秘密鍵）の生成
<ul>
<li>N個のEd25519 公開鍵 p_1, ..., p_n を生成</li>
</ul>
</li>
<li>トランザクションの認証に必要な署名の閾値である<code>K</code>の値を決定</li>
<li>公開鍵と<code>K</code>から，32バイトの認証鍵を同種
<ul>
<li><code>auth_key = sha3-256(p_1 | ... | p_n | K | 0x01)</code></li>
</ul>
</li>
<li>（永続的な）アカウントアドレスとして，3で導出した初期認証鍵を設定</li>
</ol>
</li>
</ul></div></article></div></main><footer class="container mx-auto max-w-2xl px-8 py-12 text-sm"><nav><ul class="flex flex-row gap-6 justify-center"><li><a class="text-gray-900 visited:text-gray-900 dark:text-gray-300 dark:visited:text-gray-300" href="/gialog">Home</a></li></ul></nav></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"issue":{"body":"Aptosにおける，アカウント作成時の暗号化手順\r\n\r\n0. ユーザーがアカウント作成要求を送信\r\n1. 秘密鍵と公開鍵のキーペアの生成\r\n2. ユーザーから，そのアカウントに適した署名方式を取得\r\n    - 単一署名方式 or マルチシグ方式\r\n3. 公開鍵とユーザーの署名方式を組み合わせ，32バイトの認証鍵を生成する\r\n4. 認証鍵とシーケンス番号（初期値0）の両方が，初期アカウントリソースとしてアカウントに保存される\r\n5. 認証鍵から32バイトのアカウントアドレスを生成\r\n\r\nシーケンス番号は，そのアカウントから送信されたトランザクション数を示す．トランザクションにはシーケンス番号を含み，トランザクションを処理する際に，トランザクションに含まれるシーケンス番号とアカウントが保持するシーケンス番号を比較し，一致する場合のみ実行に移す．これはリプレイ攻撃を防ぐためのもので，Ethereum だと nonce にあたる．\r\n\r\nアカウントアドレスは，アカウントの識別子として重要なリソースであるが，アカウント生成時に導出される32バイトの認証鍵がそのままアカウントアドレスになる（例：`eeff357ea5c1a4e7bc11b2b17ff2dc2dcca69750bfef1e1ebcaccf8c8018175b``）．\r\n秘密鍵と公開鍵をのちに更新でき，その場合は認証鍵も変更される．しかし，アカウントアドレスは永続的（不変）であり，認証鍵とアカウントアドレスが一致するのは，初期のみで必ずしも一致しないし，既存のアカウントアドレスが変更されることはない．\r\n\r\nAptos の署名方式には2つある．\r\n1. 単一署名方式\r\n2. マルチシグ方式\r\n\r\nそれぞれの署名方式は以下の署名スキームを用いる\r\n1. Ed25519\r\n4. MultiEd25519\r\n\r\nまた，アカウントの認証鍵を生成するには，そのアカウントについて1バイトの署名方式の識別子の指定が必要で，それぞれ以下のように識別子が定められている．\r\n1. 単一署名方式： `0x00`\r\n2. マルチシグ方式：`0x01`\r\n\r\nそれぞれの署名方式によるアカウントの生成手順は以下である．\r\n- 単一署名方式\r\n  1. キーペア（公開鍵，秘密鍵）の生成\r\n     - RFC 8032 で定義された Ed25519 curve 上の PureEdDSA スキームを使用\r\n  3. 公開鍵から，32バイトの認証鍵を導出\r\n      - `auth_key = sha3-256(publicke | 0x00)`\r\n  5. （永続的な）アカウントアドレスとして，2で導出した初期認証鍵を設定\r\n\r\n- マルチシグ方式\r\n  - K-of-Nマルチシグ認証を用いるため，定数 N, K を指定する必要がある\r\n  - K-of-Nマルチシグ認証では，アカウントに合計 N 人の署名者が存在し，N 人の署名のうち少なくとも K 人がトランザクションを認証するためにしようされなければならない\r\n  1. キーペア（公開鍵，秘密鍵）の生成\r\n      - N個のEd25519 公開鍵 p_1, ..., p_n を生成\r\n  3. トランザクションの認証に必要な署名の閾値である`K`の値を決定\r\n  4. 公開鍵と`K`から，32バイトの認証鍵を同種\r\n      - `auth_key = sha3-256(p_1 | ... | p_n | K | 0x01)`\r\n  6. （永続的な）アカウントアドレスとして，3で導出した初期認証鍵を設定\r\n","bodyHTML":"\u003cp\u003eAptosにおける，アカウント作成時の暗号化手順\u003c/p\u003e\n\u003col start=\"0\"\u003e\n\u003cli\u003eユーザーがアカウント作成要求を送信\u003c/li\u003e\n\u003cli\u003e秘密鍵と公開鍵のキーペアの生成\u003c/li\u003e\n\u003cli\u003eユーザーから，そのアカウントに適した署名方式を取得\n\u003cul\u003e\n\u003cli\u003e単一署名方式 or マルチシグ方式\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e公開鍵とユーザーの署名方式を組み合わせ，32バイトの認証鍵を生成する\u003c/li\u003e\n\u003cli\u003e認証鍵とシーケンス番号（初期値0）の両方が，初期アカウントリソースとしてアカウントに保存される\u003c/li\u003e\n\u003cli\u003e認証鍵から32バイトのアカウントアドレスを生成\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eシーケンス番号は，そのアカウントから送信されたトランザクション数を示す．トランザクションにはシーケンス番号を含み，トランザクションを処理する際に，トランザクションに含まれるシーケンス番号とアカウントが保持するシーケンス番号を比較し，一致する場合のみ実行に移す．これはリプレイ攻撃を防ぐためのもので，Ethereum だと nonce にあたる．\u003c/p\u003e\n\u003cp\u003eアカウントアドレスは，アカウントの識別子として重要なリソースであるが，アカウント生成時に導出される32バイトの認証鍵がそのままアカウントアドレスになる（例：`eeff357ea5c1a4e7bc11b2b17ff2dc2dcca69750bfef1e1ebcaccf8c8018175b``）．\r\n秘密鍵と公開鍵をのちに更新でき，その場合は認証鍵も変更される．しかし，アカウントアドレスは永続的（不変）であり，認証鍵とアカウントアドレスが一致するのは，初期のみで必ずしも一致しないし，既存のアカウントアドレスが変更されることはない．\u003c/p\u003e\n\u003cp\u003eAptos の署名方式には2つある．\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e単一署名方式\u003c/li\u003e\n\u003cli\u003eマルチシグ方式\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eそれぞれの署名方式は以下の署名スキームを用いる\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/ma96o/gialog/commit/Ed25519\"\u003e\u003ccode\u003eEd25519\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMultiEd25519\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eまた，アカウントの認証鍵を生成するには，そのアカウントについて1バイトの署名方式の識別子の指定が必要で，それぞれ以下のように識別子が定められている．\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e単一署名方式： \u003ccode\u003e0x00\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eマルチシグ方式：\u003ccode\u003e0x01\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eそれぞれの署名方式によるアカウントの生成手順は以下である．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e単一署名方式\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eキーペア（公開鍵，秘密鍵）の生成\n\u003cul\u003e\n\u003cli\u003eRFC 8032 で定義された \u003ca href=\"https://github.com/ma96o/gialog/commit/Ed25519\"\u003e\u003ccode\u003eEd25519\u003c/code\u003e\u003c/a\u003e curve 上の PureEdDSA スキームを使用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e公開鍵から，32バイトの認証鍵を導出\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eauth_key = sha3-256(publicke | 0x00)\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e（永続的な）アカウントアドレスとして，2で導出した初期認証鍵を設定\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eマルチシグ方式\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eK-of-Nマルチシグ認証を用いるため，定数 N, K を指定する必要がある\u003c/li\u003e\n\u003cli\u003eK-of-Nマルチシグ認証では，アカウントに合計 N 人の署名者が存在し，N 人の署名のうち少なくとも K 人がトランザクションを認証するためにしようされなければならない\u003c/li\u003e\n\u003c/ul\u003e\n\u003col\u003e\n\u003cli\u003eキーペア（公開鍵，秘密鍵）の生成\n\u003cul\u003e\n\u003cli\u003eN個のEd25519 公開鍵 p_1, ..., p_n を生成\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eトランザクションの認証に必要な署名の閾値である\u003ccode\u003eK\u003c/code\u003eの値を決定\u003c/li\u003e\n\u003cli\u003e公開鍵と\u003ccode\u003eK\u003c/code\u003eから，32バイトの認証鍵を同種\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eauth_key = sha3-256(p_1 | ... | p_n | K | 0x01)\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e（永続的な）アカウントアドレスとして，3で導出した初期認証鍵を設定\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e","active_lock_reason":null,"assignee":null,"assignees":[],"author_association":"OWNER","closed_at":null,"comments":0,"comments_url":"https://api.github.com/repos/ma96o/gialog/issues/19/comments","created_at":"2022-08-20T13:14:11Z","events_url":"https://api.github.com/repos/ma96o/gialog/issues/19/events","html_url":"https://github.com/ma96o/gialog/issues/19","id":1345162605,"labels":[],"labels_url":"https://api.github.com/repos/ma96o/gialog/issues/19/labels{/name}","locked":false,"milestone":null,"node_id":"I_kwDOHueoCs5QLY1t","number":19,"performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/ma96o/gialog/issues/19/reactions"},"repository_url":"https://api.github.com/repos/ma96o/gialog","state":"open","state_reason":null,"timeline_url":"https://api.github.com/repos/ma96o/gialog/issues/19/timeline","title":"0820 _ Aptos のアカウント生成","updated_at":"2022-08-20T13:14:11Z","url":"https://api.github.com/repos/ma96o/gialog/issues/19","user":{"avatar_url":"https://avatars.githubusercontent.com/u/22464192?v=4","events_url":"https://api.github.com/users/ma96o/events{/privacy}","followers_url":"https://api.github.com/users/ma96o/followers","following_url":"https://api.github.com/users/ma96o/following{/other_user}","gists_url":"https://api.github.com/users/ma96o/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/ma96o","id":22464192,"login":"ma96o","node_id":"MDQ6VXNlcjIyNDY0MTky","organizations_url":"https://api.github.com/users/ma96o/orgs","received_events_url":"https://api.github.com/users/ma96o/received_events","repos_url":"https://api.github.com/users/ma96o/repos","site_admin":false,"starred_url":"https://api.github.com/users/ma96o/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ma96o/subscriptions","type":"User","url":"https://api.github.com/users/ma96o"}},"issueComments":[]},"__N_SSG":true},"page":"/articles/[issueNumber]","query":{"issueNumber":"19"},"buildId":"JPGmInjco_EPal4DLj749","assetPrefix":"/gialog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>